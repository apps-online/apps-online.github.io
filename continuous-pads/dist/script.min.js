class Keyboard{constructor(){try{this.audio={},this.audio.pipe=[],this.audio.blob=[],this.audio.url="",this.audio.timer=null,this.audio.context=new AudioContext,this.audio.player=new WebAudioFontPlayer,this.audio.destination=new MediaStreamAudioDestinationNode(this.audio.context),this.audio.recorder=new MediaRecorder(this.audio.destination.stream),this.audio.timbre=this.timbre(),this.audio.recorder.ondataavailable=t=>{this.audio.blob.push(t.data)},this.audio.recorder.onstop=t=>{this.audio.url=URL.createObjectURL(new Blob(this.audio.blob,{type:"audio/ogg; codecs=opus"}))},this.audio.player.adjustPreset(this.audio.context,this.audio.timbre),this.addOption(),this.addEvent()}catch(t){alert("Sorry, but the Web Audio API is not supported by your browser.\nPlease, consider upgrading to the latest version or downloading Google Chrome or Mozilla Firefox.\n"+t)}}include(t){var i=t=>Object.prototype.toString.call(t).slice(8,-1).toLowerCase();if("string"===i(t)){var e=document.createElement("script");e.type="text/javascript",e.src=t,e.async=!0,document.getElementsByTagName("head")[0].appendChild(e)}else"array"===i(t)&&this.includeMulti(t)}includeMulti(t){var i=[],e="";$("head script").each(function(t){i[t]=$(this).attr("src")}),$(t).each((t,a)=>{e=a,$(i).each((t,i)=>{if(a===i)return e="",!1}),""!==e&&this.include(e)})}fileList(){return{502:"0502_FluidR3_GM_sf2_file",990:"0990_Aspirin_sf2_file"}}addOption(){var t=this.fileList();for(let i in t){let e=document.createElement("option");e.text=i,e.value=i,this.id("timbre").appendChild(e)}}id(t){return document.getElementById(t)}toggleKeyboardKey(t){if(t.classList.contains("white")){if(!t.classList.contains("white-active"))return t.classList.add("white-active"),!0;t.classList.remove("white-active")}else{if(!t.classList.contains("black-active"))return t.classList.add("black-active"),!0;t.classList.remove("black-active")}return!1}addEvent(){var t=document.querySelectorAll("#keyboard li"),i=t.length;for(let e=0;e<i;e++)t[e].addEventListener("click",t=>{this.sound(t.target.getAttribute("value"),this.toggleKeyboardKey(t.target))});this.id("timbre").addEventListener("change",t=>{this.audio.timbre=this.timbre(t.target.value),this.audio.timbre&&this.audio.player.adjustPreset(this.audio.context,this.audio.timbre)}),this.id("stop").addEventListener("click",t=>{this.stop()}),this.id("recording").addEventListener("click",t=>{switch(t.target.name){case"start":this.startRecording(t.target);break;case"stop":this.stopRecording(t.target);break;case"download":this.download()}}),this.id("reset").addEventListener("click",t=>{this.reset()})}buttonChange(t,i,e){t.name=i,t.innerHTML='<i class="fas fa-'+("start"===i?"play":i)+' me-2" aria-hidden="true"></i>'+e}timbre(t=null){var i=this.fileList();return t=t?i[t]:Object.values(i)[0],window["_tone_"+t]||this.include("https://leandro-sciola.github.io/apps/worship-pads-generator/webaudiofont/sound/"+t+".js"),window["_tone_"+t]}timer(){var t=0,i=0,e=0;return setInterval(()=>{60==(t+=1)&&(t=0,60==(i+=1)&&(i=0,e+=1)),this.id("timer").value=String(e).padStart(2,"0")+":"+String(i).padStart(2,"0")+":"+String(t).padStart(2,"0")},1e3)}stop(t=null){var i=document.querySelectorAll("#keyboard li"),e=i.length;if(t){t.cancel();for(let a=0;a<e;a++)if(i[a].classList.contains("white-active")||i[a].classList.contains("black-active"))return}else{this.audio.player.cancelQueue(this.audio.context);for(let s=0;s<e;s++)i[s].classList.contains("white-active")?i[s].classList.remove("white-active"):i[s].classList.contains("black-active")&&i[s].classList.remove("black-active")}clearInterval(this.audio.timer),this.audio.timer=null,this.id("stop").classList.add("disabled")}sound(t,i){i?(this.audio.timer||(this.audio.timer=this.timer(),this.id("stop").classList.remove("disabled")),this.audio.pipe[t]=this.audio.player.queueWaveTable(this.audio.context,this.audio.context.destination,this.audio.timbre,this.audio.context.currentTime+0,{"1-1":12,"2-1":13,"3-1":14,"4-1":15,"5-1":16,"6-1":17,"7-1":18,"8-1":19,"9-1":20,"10-1":21,"11-1":22,"12-1":23,"1-2":24,"2-2":25,"3-2":26,"4-2":27,"5-2":28,"6-2":29,"7-2":30,"8-2":31,"9-2":32,"10-2":33,"11-2":34,"12-2":35,"1-3":36,"2-3":37,"3-3":38,"4-3":39,"5-3":40,"6-3":41,"7-3":42,"8-3":43,"9-3":44,"10-3":45,"11-3":46,"12-3":47,"1-4":48,"2-4":49,"3-4":50,"4-4":51,"5-4":52,"6-4":53,"7-4":54,"8-4":55,"9-4":56,"10-4":57,"11-4":58,"12-4":59}[t],999999,!0),this.audio.pipe[t].connect(this.audio.destination)):this.stop(this.audio.pipe[t])}startRecording(t){this.audio.recorder.start(),this.buttonChange(t,"stop","Stop recording")}stopRecording(t){this.audio.recorder.requestData(),this.audio.recorder.stop(),this.buttonChange(t,"download","Download")}download(){var t=document.createElement("a"),i=(Math.random()*new Date().getTime()).toString(10).replace(/\./g,"");t.setAttribute("download","pad_"+i),t.href=this.audio.url,document.body.appendChild(t),t.click(),t.remove()}reset(){this.audio.player.cancelQueue(this.audio.context),location.reload(!0)}}